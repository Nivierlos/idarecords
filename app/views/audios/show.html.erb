<% if current_user%>
    <% if @audio.user_id == current_user.id %>
        <%= link_to  "Update Audio ", edit_audio_path(@audio), class:'btn btn-info pull-right' %>
    <% end %>
<% end %>

<h3 class="text-center"><%= @audio.title%> by <span><%= @audio.artist%></span></h4>
<div class="row">
    <div class="col-md-10">
        <div class="panel panel-default"  id="playSong">
            
        </div>
    </div>
    <div class="col-md-2">
        <% if @types.exists%>
            <div class="panel panel-nfio">
                <div class="panel panel-heading">
                    <h4 >Categories</h4>
                </div>
                <div class="panel panel-body">
                   <% @types.each do |type|%>
                        <li class="list-group-item"><%= link_to type.name, type_path(type), class:'glyphicon glyphicon-film'  %></li>
                    <%end%> 
                </div>
            </div>
        <%else%>
        <p>No categories found</p>
        <%end%>
    </div>
</div> <!-- show audio page -->
<div class="row">
    <div class="col-md-10">
        <%if @audios.exists? %>
           <div class="recent-upload">
                <h4>RECENT UPLOADED AUDIO</h4>
           </div>
            <div class="row" id="mainSongs">
                
            </div>
                    
        <%else%>
            <p>No song published yet</p>
        <% end %>
        <!-- pagination -->
        <%= paginate @audios, :theme => 'twitter-bootstrap-3' %>
    </div>
    <div class="col-md-2">
        <div class="same-author">
            <div class="panel panel-info">
                <div class="panel panel-heading">
                    <h4 class=""> Related Audios</h4>
                </div>
                <% if @artists.exists? %>
                <div class="row">
                    <% @artists.each do |artist| %>
                        <div class="panel-body">
                            <%= link_to audio_path(artist) do %>                                            
                                <%if artist.coverpicture.present?%>
                                    <%= image_tag  "#{artist.coverpicture}", class:'thumbnail', width:'100%', height:'50%' %>
                                <%else%>
                                    <%= image_tag  "img/image2.jpg", class:'thumbnail', width:'100%', height:'200px' %>
                                <% end %>
                                <li><strong>Song name: </strong><%= artist.title%></li>
                                <li><strong>Upload on: </strong> <%= artist.created_at.to_time.strftime('%b %e, %Y ') %></li>
                                <%= link_to  "Play", audio_path(artist), class:'glyphicon glyphicon-ok btn btn-block btn-success audioButton', id:'playblack' %>
                            <% end %> 
                        </div> 
                    <% end %>
                </div>
                    
                <% else %>
                <p>No song with the same artist found!!</p>
                <% end %>
            </div>
        </div>  
        <!-- Song with the same artist -->
    </div>
</div>

<script>
  $(document).ready(function(){
      mainWindow();
      allSongs();
     function mainWindow(){
         $('#playSong').html(`
            <div class="panel panel-body">
               <% if @audio.coverpicture.present?%>
                 <% if @audio.song_audio.present?%>
                 <%= image_tag  "#{@audio.coverpicture}", class:'thumbnail', width:'100%', height:'400px' %>
                 <%= audio_tag  "#{@audio.song_audio}", controls: true, id:'audio-play', width:'100%', style:"background-image: url(#{@audio.coverpicture}); border-radius: 28px; width: 100%;"  %>
               <% else%>
                <p>No song uploaded</p>
                <% end%>
               <% else%>
                <% if @audio.song_audio.present?%>
                 <%= audio_tag  "#{@audio.song_audio}", controls: true, width:'100%', style:" height: 300px; border-radius: 28px; top: 40%; left: 50%;"  %>
               <% else%>
                <p>No thing to show</p>
                <% end%>
                <% end%>
                
            </div>
            `);
       
     } 

     function allSongs(){
         $('#mainSongs').html(`
            <% @audios.each do |song|%>
                <div class="col-md-4 ">
                    <div class="panel panel-info">
                        <div class="panel-body">
                            
                            <%if song.coverpicture.present?%>
                                <%= image_tag  "#{song.coverpicture}", class:'thumbnail', width:'100%', height:'200px' %>
                            <%else%>
                                <%= image_tag  "img/image2.jpg", class:'thumbnail', width:'100%', height:'200px' %>
                            <% end %>
                                <li><strong>Song name: </strong><%= song.title%></li>
                                <li><strong>Artist: </strong><%= song.artist %></li>
                                <li><strong>Upload on: </strong> <%= song.created_at.to_time.strftime('%b %e, %Y ') %></li>
                                <%= link_to  "Play", audio_path(song), class:'glyphicon glyphicon-ok btn btn-block btn-success audioButton', id:'playblack' %>
                        </div>
                    </div> 
                </div>
                <% end %>
         `);
     }
    
     $(".playback").click(function(e) {
       e.preventDefault();

       // This next line will get the audio element
       // that is adjacent to the link that was clicked.
       var song = $(this).next('audio').get(0);
       if (song.paused)
         song.play();
       else
         song.pause();
     });
    
  });  
</script>


